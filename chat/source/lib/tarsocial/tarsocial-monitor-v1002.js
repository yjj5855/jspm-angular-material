function TarMonitor(){function start(){var posturl="http://slb2.tarsocial.com/in/wxs",encrypturl="http://www.h5mo.com/api/encrypt",params=getUrlArgMap(),tar_foid=params.tar_foid,tar_from=params.from;("undefined"==typeof tar_foid||null==tar_foid||""==tar_foid)&&(tar_foid="root"),("undefined"==typeof tar_oid||null==tar_oid)&&(tar_oid=""),("undefined"==typeof tar_nickname||null==tar_nickname)&&(tar_nickname=""),("undefined"==typeof tar_sex||null==tar_sex)&&(tar_sex=""),("undefined"==typeof tar_province||null==tar_province)&&(tar_province=""),("undefined"==typeof tar_city||null==tar_city)&&(tar_city=""),("undefined"==typeof tar_country||null==tar_country)&&(tar_country=""),("undefined"==typeof tar_headimgurl||null==tar_headimgurl)&&(tar_headimgurl=""),("undefined"==typeof tar_from||null==tar_from)&&(tar_from=""),("undefined"==typeof tar_unionid||null==tar_unionid)&&(tar_unionid=""),("undefined"==typeof tar_url||null==tar_url)&&(tar_url=""),("undefined"==typeof tar_refer||null==tar_refer)&&(tar_refer=""),("undefined"==typeof tar_width||null==tar_width)&&(tar_width=""),("undefined"==typeof tar_height||null==tar_height)&&(tar_height=""),Ajax.request(encrypturl,{method:"POST",data:{tar_eventid:tar_event,tar_oid:tar_oid},success:function(r){var ret=eval("("+r.response+")");tar_encrypt=ret.encrypt,tar_sharedata=ret.sharedata}}),Ajax.request(posturl,{method:"POST",data:{tar_uuid:tar_uuid,tar_event:tar_event,tar_oid:tar_oid,tar_foid:tar_foid,tar_nickname:tar_nickname,tar_sex:tar_sex,tar_province:tar_province,tar_city:tar_city,tar_country:tar_country,tar_headimgurl:tar_headimgurl,tar_from:tar_from,tar_unionid:tar_unionid,tar_url:tar_url,tar_refer:tar_refer,tar_width:tar_width,tar_height:tar_height}})}function getUrlArgMap(){for(var a=new Object,b=location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("=");if(-1!=e){var f=c[d].substring(0,e),g=c[d].substring(e+1);a[f]=unescape(g)}}return a}function setCookie(a,b){var c=a+"="+escape(b);document.cookie=c}function getCookie(a){var b,c=null,d=document.cookie+";",e=a+"=",f=d.indexOf(e);return-1!=f&&(f+=e.length,b=d.indexOf(";",f),c=unescape(d.substring(f,b))),c}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}var tar_event="",tar_uuid="",tar_oid="",tar_foid="",tar_nickname="",tar_sex="",tar_province="",tar_city="",tar_country="",tar_headimgurl="",tar_unionid="",tar_shareid="",tar_url=location.href,tar_refer=document.referrer,tar_width=document.documentElement.clientWidth,tar_height=document.documentElement.clientHeight,tar_sharedata=!1,tar_encrypt=!1;this.config=function(a,b){tar_event=a.tar_tid;var c=null;if(b&&b[0]&&b[0].openid&&(c=b[0]),"undefined"!=typeof c&&null!=c)tar_oid=c.openid,tar_nickname=c.nickname,tar_sex=c.sex,tar_province=c.province,tar_city=c.city,tar_country=c.country,tar_headimgurl=c.headimgurl,tar_unionid=c.unionid,tar_uuid="0";else{var d="tar-uuid-"+tar_event,e=window.localStorage.getItem(d);"undefined"==typeof e||null==e||""==e?(e=getCookie(d),tar_oid="undefined"==typeof e||null==e||""==e?guid():e,window.localStorage.setItem(d,tar_oid)):tar_oid=e,setCookieAdv(d,tar_oid,365),tar_uuid="1"}start()},this.shapeShareAppMessage=function(data_in){var data=new Object;for(var key in data_in)data[key]=data_in[key];("undefined"==typeof tar_oid||null==tar_oid)&&(tar_oid="");var data_success="null";"function"==typeof data.success&&(data_success=data.success);var success=function(){if("null"!=data_success){var succ_callback_string=data_success.toString(),succ_callback=eval("new "+succ_callback_string);"function"==typeof succ_callback&&succ_callback()}var url2="http://slb2.tarsocial.com/in/wxf";Ajax.request(url2,{method:"POST",data:{tar_event:tar_event,tar_oid:tar_oid,tar_kind:"friend",tar_status:"success"}})};data.success=success;var data_cancel="null";"function"==typeof data.cancel&&(data_cancel=data.cancel);var cancel=function(){if("null"!=data_cancel){var cancel_callback_string=data_cancel.toString(),cancel_callback=eval("new "+cancel_callback_string);"function"==typeof cancel_callback&&cancel_callback()}var url2="http://slb2.tarsocial.com/in/wxf";Ajax.request(url2,{method:"POST",data:{tar_event:tar_event,tar_oid:tar_oid,tar_kind:"friend",tar_status:"cancel"}})};return data.cancel=cancel,data.type=0,shapeShareData(data)},this.shapeShareTimeline=function(data_in){var data=new Object;for(var key in data_in)data[key]=data_in[key];"undefined"!=typeof tar_oid&&tar_oid||(tar_oid="");var data_success="null";"function"==typeof data.success&&(data_success=data.success);var success=function(){if("null"!=data_success){var succ_callback_string=data_success.toString(),succ_callback=eval("new "+succ_callback_string);"function"==typeof succ_callback&&succ_callback()}var url2="http://slb2.tarsocial.com/in/wxf";Ajax.request(url2,{method:"POST",data:{tar_event:tar_event,tar_oid:tar_oid,tar_kind:"timeline",tar_status:"success"}})};data.success=success;var data_cancel="null";"function"==typeof data.cancel&&(data_cancel=data.cancel);var cancel=function(){if("null"!=data_cancel){var cancel_callback_string=data_cancel.toString(),cancel_callback=eval("new "+cancel_callback_string);"function"==typeof cancel_callback&&cancel_callback()}var url2="http://slb2.tarsocial.com/in/wxf";Ajax.request(url2,{method:"POST",data:{tar_event:tar_event,tar_oid:tar_oid,tar_kind:"timeline",tar_status:"cancel"}})};return data.cancel=cancel,data.type=1,shapeShareData(data)};var shapeShareData=function(a){var b=getUrlArgMap(),c=b.tar_shareid;("undefined"==typeof c||null==c)&&(c=""),tar_foid=b.tar_foid,("undefined"==typeof tar_foid||null==tar_foid||""==tar_foid)&&(tar_foid="root");var d=tar_encrypt,e=tar_sharedata,f=d&&d.length>0?d:tar_oid;return/\?/i.test(a.link)?/tar_foid/.test(a.link)?a.link.replace(/tar_foid=[^\?\&\#]*/,"tar_foid="+f):a.link=a.link+"&tar_foid="+f:a.link=a.link+"?tar_foid="+f,tar_foid=d,e&&(e.share_img&&(a.imgUrl=e.share_img),e.share_desc&&(a.desc=e.share_desc),e.share_title&&(a.title=e.share_title)),a},Ajax=function(){function a(a,d){function e(){}var f=d.async!==!1,g=d.method||"GET",h=d.data||null,i=d.success||e,j=d.failure||e;g=g.toUpperCase(),"GET"==g&&h&&(h=c(h),a+=(-1==a.indexOf("?")?"?":"&")+h,h=null);var k=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return k.onreadystatechange=function(){b(k,i,j)},k.open(g,a,f),"POST"==g&&(h=c(h),k.setRequestHeader("Content-type","application/x-www-form-urlencoded;")),k.send(h),k}function b(a,b,c){if(4==a.readyState){var d=a.status;d>=200&&300>d?b(a):c(a)}}function c(a){if("string"==typeof a||null==a)return a;if("object"==typeof a){var b="";for(var c in a)b="&"+c+"="+a[c]+b;return b.substr(1)}return a.toString()}return{request:a}}()}function setCookieAdv(a,b,c){var d=new Date;d.setDate(d.getDate()+c),document.cookie=a+"="+escape(b)+(null==c?"":";expires="+d.toGMTString())}function getCookieAdv(a){if(document.cookie.length>0&&(c_start=document.cookie.indexOf(a+"="),-1!=c_start)){c_start=c_start+a.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length);var b=unescape(document.cookie.substring(c_start,c_end));return b}return""}var tar=new TarMonitor;